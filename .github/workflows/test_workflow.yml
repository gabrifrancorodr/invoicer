name: Test Workflow

on:
  push:
    branches:
      - main

jobs:
  test:
    name: Test1
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v2
      - name: Install Ruby 3.0
        run: |
          sudo apt update
          sudo apt install git curl libssl-dev libreadline-dev zlib1g-dev autoconf bison build-essential        libyaml-dev libreadline-dev libncurses5-dev libffi-dev libgdbm-dev
          curl -sL https://github.com/rbenv/rbenv-installer/raw/master/bin/rbenv-installer | bash -
          echo 'export PATH="$HOME/.rbenv/bin:$PATH"' >> ~/.bashrc
          echo 'eval "$(rbenv init -)"' >> ~/.bashrc
          exec $SHELL
          rbenv install -l
          rbenv install 3.0.0
          rbenv global 3.0.0
          gem update --system
          gem install bundler
          ruby -v
      - name: Test App Action
        run: |
          bin/rails test
      - name: Deploy App To Heroku
        run: |
          git push heroku main
          bin/setup
          bin/rails server